<html>
  <head>
    <title>Step Chart</title>
    <link rel="stylesheet" type="text/css" href="css/index.css" media="screen" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.8.5.custom.css" media="screen" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/slick.grid.css" media="screen" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/grid.css" media="screen" charset="utf-8"/>
    
    <script type="text/javascript" src="libs/jquery-1.5.1.min.js"></script>
    <script type="text/javascript" src="libs/jquery-ui-1.8.14.custom.min.js"></script>
    <script type="text/javascript" src="libs/jquery.event.drag-2.0.min.js"></script>
    <script type="text/javascript" src="libs/protovis-d3.2.js"></script>
    <script type="text/javascript" src="libs/date-en-GB.js"></script>
    <script type="text/javascript" src="libs/slick.core.js"></script>
    <script type="text/javascript" src="libs/slick.grid.js"></script>
    <script type="text/javascript" src="libs/slick.editors.js"></script>
    <script type="text/javascript" src="libs/slick.dataview.js"></script>
    <script type="text/javascript" src="libs/caware.ColourPool.js"></script>
    <script type="text/javascript" src="libs/caware.IntValueStore.js"></script>
    <script type="text/javascript" src="libs/caware.PlotController.js"></script>
    <script type="text/javascript" src="libs/caware.SensorAccessor.js"></script>
    <script type="text/javascript" src="libs/caware.util.js"></script>
    <script type="text/javascript" src="libs/caware.core.js"></script>
    <script type="text/javascript" src="libs/caware.JSONCache.js"></script>
    <script type="text/javascript" src="libs/WeatherJSONBridge.js"></script>
    
    <style type="text/css">

#fig {
  width: 430px;
  height: 225px;
}

    </style>
  </head>
  <body><div id="center"><div id="fig">
    <script type="text/javascript+protovis">
    
    var freq = {
    "label": "Grid Frequency Meter",
    "path": "meters.cl.cam.ac.uk/freq",
    "description": "frequency",
    "units" : "Hz",
    "ts" : "2011-09-06T10Z",
    "data": [
[1315303647000,  49.91],
[1315303648000,  49.92],
[1315303649000,  49.93],
[1315303650000,  49.94],
[1315303651000,  49.95],
[1315303652000,  49.96],
[1315303653000,  49.97],
[1315303654000,  49.98],
[1315303655000,  49.99],
[1315303656000,  50.00],
[1315303657000,  50.01],
[1315303658000,  50.02],
[1315303659000,  50.01],
[1315303660000,  50.00],
[1315303661000,  49.98],
[1315303662000,  49.93],
[1315303663000,  49.94],
[1315303664000,  49.95],
[1315303665000,  49.96],
[1315303666000,  49.97]]};

var dataArray = freq.data;

var data = [];

for (var i=0; i<dataArray.length; i++){
    //var key = new Date(dataArray[i][0]);
    //data[key] = dataArray[i][1];
    data.push({x:new Date(dataArray[i][0]),y:dataArray[i][1]})
}

//console.log(data);

/* Sizing and scales. */
var w = 1300,
    h = 700,
    x = pv.Scale.linear(data, function(d) d.x).range(0, w),
    y = pv.Scale.linear(49.85, 50.30).range(0, h);

/* The root panel. */
var vis = new pv.Panel()
    .width(w)
    .height(h)
    .bottom(20)
    .left(20)
    .right(10)
    .top(5);

/* X-axis ticks. */
vis.add(pv.Rule)
    .data(x.ticks())
    .visible(function(d) d > 0)
    .left(x)
    .strokeStyle("#eee")
  .add(pv.Rule)
    .bottom(-5)
    .height(5)
    .strokeStyle("#000")
  .anchor("bottom").add(pv.Label)
    .text(x.tickFormat);

/* Y-axis ticks. */
vis.add(pv.Rule)
    .data(y.ticks(5))
    .bottom(y)
    .strokeStyle(function(d) d ? "#eee" : "#000")
  .anchor("left").add(pv.Label)
    .text(y.tickFormat);

/* The line. */
vis.add(pv.Line)
    .data(data)
    .interpolate("step-after")
    .left(function(d) x(d.x))
    .bottom(function(d) y(d.y))
    .segmented(true)
    .strokeStyle(function(d){
        console.log(d.y);
        if (d.y == 50) { return "blue"};
        if (d.y > 50) { return "red"};
        if (d.y < 50) { return "green"};
    })
    .lineWidth(3);

vis.render();

    </script>
  </div></div></body>
</html>