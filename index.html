<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>WGB Energy Usage</title>
    
    <script type="text/javascript" src="libs/jquery-1.5.1.min.js"></script>
    <script src="libs/jquery.event.drag-2.0.min.js"></script>
    <script type="text/javascript" src="libs/protovis-d3.2.js"></script>
    <script type="text/javascript" src="libs/date-en-GB.js"></script>
    <script src="libs/slick.core.js"></script>
    <script src="libs/slick.grid.js"></script>
    <script src="libs/slick.editors.js"></script>
    <script src="libs/slick.dataview.js"></script>
    <script type="text/javascript" src="libs/caware.ColourPool.js"></script>
    <script type="text/javascript" src="libs/caware.IntValueStore.js"></script>
    <script type="text/javascript" src="libs/caware.PlotController.js"></script>
    <script type="text/javascript" src="libs/caware.util.js"></script>
    <script type="text/javascript" src="libs/caware.core.js"></script>
    <script type="text/javascript" src="libs/caware.JSONCache.js"></script>
    
    <script type="text/javascript+protovis">
    var indexUrl = "http://www.cl.cam.ac.uk/~cce25/test3.json";
    
    //Set plot colours
    var linecolours = new Array("firebrick","seagreen","steelblue","gold","darkorange","blue","limegreen","purple","sienna","darkturquoise");
    
    var maxPlots = 10;
    
    //Date formats for chart tick labels
    var zoomDateFormat = pv.Format.date("%a %d %b");
    var zoomTimeFormat = pv.Format.date("%H:%M");
    var overallDateFormat = pv.Format.date("%d %b '%y");
    
    //Vars for array of plots, and chart visulisation
    var cache = new JSONCache();
    var plotArray = new Array();
    var treeIndex = new IntValueStore();
    var plotController = new PlotController(maxPlots,indexUrl);
    var colourpool = new ColourPool(linecolours);
    
    var vis;
    var sensors;
    
    //var oldd1, oldd2;
    var initialzoomx = 100, initialzoomdx = 200;
    var datazoomx, datazoomdx;
    var zoomx = 100, zoomdx = 200;
    
    //var sensorTree; //Variable to store current sensor tree
    //var foundSensors; //Variable to store all availible sensors
    //var cachedReadings = {}; //Object to store previously fetched sensor data
    
     $(document).ready(function() {
        checkCookie("WGBToolVisit");
        buildTree("treeuse");
    });
    
    
    
    
    function tree(sensortree,type){
            //Create tree from sensor index object.
            
            //Specify the root node from the tree JS object
            var root = pv.dom(sensortree)
                .root("Sensors");
            
            //Create the root visualisation panel
            var treevis = new pv.Panel()
                .def("i", -1)
                .canvas("treediv")
                .width(380)
                .height(function(){ return((root.nodes().length + 1) * 24);})
                .margin(5);
            
            //Create the Indentation layout
            var layout = treevis.add(pv.Layout.Indent)
                .nodes(function() {return root.nodes();})
                .depth(24)
                .breadth(24);
            
            //layout.link.add();
            
            //Add nodes to the layout
            var node = layout.node.add(pv.Panel)
               .top(function(n){return(n.y-6);})
               .height(12)
               .right(6)
               .strokeStyle("none")
               .fillStyle("rgb(235, 235, 235)")
               .events("all")
               .cursor("pointer")
               .event("mousedown", toggle);
            
            node.anchor("left").add(pv.Dot)
                .radius("7")
                //.shape("triangle")
                .shape(function(n){
                    if (n.nodeName.split(" ",1)[0] == "Monitored"){return "circle";}
                    //else if  == "Ground" || n.nodeName == "First" || n.nodeName == "Second" || n.nodeName == "Sensors" || n.nodeName == "Electricity"){
                    //    return "triangle";
                    if (!n.toggled && !n.firstChild){return "square";}
                    else {return "triangle";}
                    })
                //.top(5)
                .left(10)
                .angle(function(n){
                    if (n.toggled){return (Math.PI*1.5); }
                    })
                .strokeStyle("#999")
                .fillStyle(function(n){
                    var nodedata = treeIndex.getItem(n.nodeValue);
                    if (typeof nodedata != "undefined"){
                        //var tmparray = [];
                        //for (y=0; y<nodedata[1].length; y++){
                        //    tmparray[y] = "http://www.cl.cam.ac.uk/meters"+nodedata[1][y];
                        //}
                        var col = colourpool.getColour(treeIndex.getItem(n.nodeValue)[1]);
                        if (col) return col;
                    }
                    if (n.nodeName.split(" ",1)[0] == "Average"){return "#FFFFFE";}
                    if (n.firstChild){ return "#AAAAAA"; }
                    else {return "#FFFFFE";}
                    return "#FF0000";
                })
                .title(function t(d) d.parentNode ? (t(d.parentNode) + "." + d.nodeName) : d.nodeName)
                .anchor("right").add(pv.Label)
                    .text(function(n){return n.nodeName;})
                    .font("12px/14px Helvetica, Arial, Sans-serif");
                    
            //treevis.render();
            
            root.sort(nodeSort);
            
            var today = new Date();
            var thismonth = today.toString("MMMM")
            
            //console.log('test');
            var nodes = root.nodes();
            for(var i=0; i<nodes.length;i++){
                var nm = nodes[i].nodeName
                if (nm=="Ground Floor"){nodes[i].toggle();}
                else if (nm=="First Floor"){nodes[i].toggle();}
                else if (nm=="Second Floor"){nodes[i].toggle();}
                else if (nm=="North Corridor"){nodes[i].toggle();}
                else if (nm=="South Corridor"){nodes[i].toggle();}
                else if (nm=="East Corridor"){nodes[i].toggle();}
                else if (nm=="West Corridor"){nodes[i].toggle();}
                else if (nm=="Centre Corridor"){nodes[i].toggle();}
                else if (nm=="Kitchen"){nodes[i].toggle();}
                else if (nm=="External"){nodes[i].toggle();}
                else if (nm=="Computers"){nodes[i].toggle();}
                else if (nm=="A/C"){nodes[i].toggle();}
                else if (nm=="Server Power and Server A/C"){nodes[i].toggle();}
                else if (nm=="Lighting and a/c"){
                    nodes[i].toggle();
                    nodes[i].nodeName = "Lighting and A/C";
                }
                else if (nm=="Lighting"){nodes[i].toggle();}
                else if (nm=="Sockets"){nodes[i].toggle();}
                else if (nm=="Power"){nodes[i].toggle();}
                else if (nm=="Lighting and sockets"){
                    nodes[i].toggle();
                    nodes[i].nodeName = "Lighting and Sockets";
                }
                else if (nm=="Kitchen power"){
                    nodes[i].toggle();
                    nodes[i].nodeName = "Kitchen Power";
                }
                else if (nm=="Machine room a/c"){
                    nodes[i].toggle();
                    nodes[i].nodeName = "Machine Room A/C";
                }
                else if (nm=="Machine room power"){
                    nodes[i].toggle();
                    nodes[i].nodeName = "Machine Room Power";
                }
                else if (nm=="Machine room power and a/c"){
                    nodes[i].toggle();
                    nodes[i].nodeName = "Machine Room Power and A/C";
                }
                else if (nm=="Lighting and server A/C"){nodes[i].toggle();}
                if (nm == "Average"){
                    //nodes[i].nodeName = "Average this month: "+Math.round(nodes[i].nodeValue[0] * 100)/100+" kW";
                    //console.log(treeIndex);
                    //console.log(nodes[i]);
                    nodes[i].nodeName = "Monitored Average ("+thismonth+") : "+Math.round(treeIndex.getItem(nodes[i].nodeValue)[0] * 100)/100+" kW";
                }
                if (nm.slice(0,8) == "Building"){
                    //nodes[i].nodeName = "Average this month: "+Math.round(nodes[i].nodeValue[0] * 100)/100+" kW";
                    //console.log(treeIndex);
                    //console.log(nodes[i]);
                    nodes[i].nodeName = nm+" Average ("+thismonth+") : "+Math.round(treeIndex.getItem(nodes[i].nodeValue)[0] * 100)/100+" kW";
                }
            }
            //console.log('testo');
            
            //root.sort(nodeSort);
            //console.log(root);
            
            treevis.render();
            
            function nodeSort(node1, node2) {
                var tmp = new Array(node1.nodeName, node2.nodeName);
                
                
                //Make the Overall node always appear first
                if (tmp[0].substring(0,8) == "Building" ){
                    return -1;
                }
                else if (tmp[1].substring(0,8) == "Building" ){
                    return 1;
                }
                //Make the Average node always 2n @ the top
                if (tmp[0].substring(0,7) == "Average" ){
                    return -1;
                }
                else if (tmp[1].substring(0,7) == "Average" ){
                    return 1;
                }
            
                
                //tmp.sort();
                if (type == "treegeo"){
                    //console.log('treegeo');
                    if (tmp[0].substring(0,6) == "Ground" ){
                        return -1;
                    }
                    if (tmp[1].substring(0,6) == "Ground" ){
                        return 1;
                    }
                    if (tmp[0].substring(0,5) == "First" ){
                        return -1;
                    }
                    if (tmp[1].substring(0,5) == "First" ){
                        return 1;
                    } 
                    if (tmp[0].substring(0,6) == "Second" ){
                        return -1;
                    }
                    if (tmp[1].substring(0,6) == "Second" ){
                        return 1;
                    }
                }
                else if (type == "treeuse"){
                    //console.log('treeuse');
                    //console.log(tmp);
                    if (tmp[0].substring(0,6) == "Ground" ){
                        //console.log('0ground detect!');
                        //console.log(tmp);
                        if (tmp[1].substring(0,6) != "Second" && tmp[1].substring(0,5) != "First"){
                            return 1;
                        }
                    }
                    if (tmp[1].substring(0,6) == "Ground" ){
                        //console.log('1ground detect!');
                        //console.log(tmp);
                        if (tmp[0].substring(0,6) != "Second" && tmp[0].substring(0,5) != "First"){
                            return -1;
                        }
                    }
                    if (tmp[0].substring(0,5) == "First" ){
                        //console.log('0first detect!');
                        //console.log(tmp);
                        if (tmp[1].substring(0,6) != "Second"){
                            return 1;
                        }
                    }
                    if (tmp[1].substring(0,5) == "First" ){
                        //console.log('1first detect!');
                        //console.log(tmp);
                        if (tmp[0].substring(0,6) != "Second"){
                            return -1;
                        }
                    }
                    if (tmp[0].substring(0,6) == "Second" ){
                        //console.log('0-2nd detect!');
                        return 1
                    }
                    if (tmp[1].substring(0,6) == "Second" ){
                        //console.log('1-2nd detect!');
                        return -1
                    }
                }
                
                tmp.sort();
                if (node1.nodeName == tmp[0]){ return -1; }
                else if (node2.nodeName == tmp[0]){ return 1; }
                else if (node1.nodeName == node2.nodeName){ return 0; }
            }
            
            function toggle(n) {
                n.toggle(pv.event.altKey);
                
                //If the node clicked is a leaf node
                if ((typeof n.nodeValue != "undefined")){
                    //time1 = new Date();
                    //console.log("Clicked");
                    //$('#chartdiv').text('LOADING...');
                    //Grab the URLs ascoiated with teh node, add the TLD to them and call plot
                    var ploturl = new Array();
                    var sensorurl = treeIndex.getItem(n.nodeValue)[1];
                    
                    
                    //var ploturl = "http://www.cl.cam.ac.uk/meters"+treeIndex.getItem(n.nodeValue)[1];
                    //chart(ploturl);
                    //var todaydate = new Date();
                    //console.log(sensorurl);
                    colourpool.toggleColour(sensorurl);
                    
                    if (plotController.togglePlotByUrl(sensorurl) < 0){
                        colourpool.toggleColour(sensorurl);
                    }
                    //console.log(todaydate);
                    
                    plotController.calculateData();
                    //time2 = new Date();
                    //console.log('Rendered in: '+time1.getTime()-time2.getTime());
                    //console.log("Clicked: "+ploturl);
                }
                //    chart(plot, "multiple");
                //}
                refreshTree();
                return layout.reset().root;
            }
        }
            
            
            function actuallyChart(dataArray,start,end,chartmax,chartcount,plotcol){
                var data = dataArray;
                //console.log(data);
                /* Scales and sizing. */
                var w = 700,
                    h1 = 310,
                    h2 = 50,
                    x = pv.Scale.linear(start, end).range(0, w),
                    //y = pv.Scale.linear(0, pv.max(data, function(d) d.y)).range(0, h2);
                    y = pv.Scale.linear(0, chartmax).range(0, h2);
                    
                /* Interaction state. Focus scales will have domain set on-render. */
                
                var i = {x:zoomx, dx:zoomdx};
                var fx = pv.Scale.linear().range(0, w),
                    fy = pv.Scale.linear().range(0, h1);
                
                /* Root panel. */
                vis = new pv.Panel()
                    .canvas("chartdiv")
                    .width(w)
                    .height(h1 + 30 + h2)
                    .bottom(20)
                    .left(30)
                    .right(20)
                    .top(20);
                
                
            function datasel(id){
                d1 = x.invert(zoomx);
                zoomx = i.x;
                d2 = x.invert(zoomx + zoomdx);
                zoomdx = i.dx;
                
                var dd = [];
                for(var j=0; j<data.length; j++){//for each line in the data array
                    dd[j] = [];
                    
                    dd[j] = (data[j].slice(Math.max(0, pv.search.index(data[j], d1, function(d) d.x) - 1),
                        pv.search.index(data[j], d2, function(d) d.x) + 1));
                    
                }
                fx.domain(d1, d2);
                if (typeof id == 'undefined') return dd;
                else {
                    return dd[id];
                }
            }
            
                
         /* Focus panel (zoomed in). */
            var focus = vis.add(pv.Panel)
                .def("init", function() {
                    date1 = new Date();
                    var dd = datasel();
                    var tot = 0;
                    var maxy = 0;
                    var miny = 0;
                    
                    for(var a=0;a<data.length;a++){
                        tot = 0;
                        var tmp = dd[a]
                        for(var b=0; b<tmp.length;b++){
                            tot+=tmp[b].y;
                            if(tmp[b].y > maxy){
                                maxy = tmp[b].y
                            }
                            if(b == 0 && a == 0){miny = tmp[b].y;}
                            else{
                                if(tmp[b].y < miny){miny = tmp[b].y;}
                            }
                        };
                        var avg = tot / tmp.length;
                        var roundavg = Math.round(avg*1000)/1000;
                        
                        plotController.updateAvgByIndex(a, roundavg);
                    }
                    
                    //$('#averagekwh').text('Average power for selected region: '+roundavg+" kW.");
                    drawgrid();
                    
                    //if (scalefit.checked){ fy.domain([0, maxy]); }
                    //else if (scalezoomed.checked){ fy.domain([miny, maxy]); }
                    //else if (scaleoriginal.checked){ 
                    fy.domain(y.domain());
                    //}
                    
                    date2 = new Date();
                    //console.log(date2.getMilliseconds()-date1.getMilliseconds());
                    return dd;
                })
                .top(0)
                .height(h1);
            
            /* X-axis ticks. */
            focus.add(pv.Rule)
                .data(function(){return fx.ticks(7);})
                .left(fx)
                .strokeStyle(function(d) d ? "#aaa" : "#000")
                .lineWidth(function(d){
                    var tmp = new Date(d);
                    if (tmp.getDay() == 6 || tmp.getDay() == 1){
                        if (tmp.getHours() == 0){ return 3; }
                        else return 1;
                    }
                    else return 1;
                })
                .anchor("bottom").add(pv.Label)
                    .text(function(fx){ return zoomTimeFormat.format(fx);});
            
            focus.add(pv.Rule)
                .data(function(){return fx.ticks(7);})
                .left(fx)
                .strokeStyle("rgba(255,255,255,0)")
                .anchor("top").add(pv.Label)
                    .text(function(fx){ return zoomDateFormat.format(fx);});
            
            /* Y-axis ticks. */
            focus.add(pv.Rule)
                .data(function() fy.ticks(7))
                .bottom(fy)
                .strokeStyle(function(d) d ? "#aaa" : "#000")
                .anchor("left").add(pv.Label)
                .text(fy.tickFormat);
            
            /* Focus area chart. */
            
            panel = focus.add(pv.Panel)
                .overflow("hidden");
            
            //console.log('------------------');
            switch (chartcount) {
                case 10:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(9); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[9])
                        .lineWidth(2);
                case 9:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(8); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[8])
                        .lineWidth(2);
                case 8:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(7); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[7])
                        .lineWidth(2);
                case 7:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(6); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[6])
                        .lineWidth(2);
                case 6:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(5); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[5])
                        .lineWidth(2);
                case 5:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(4); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[4])
                        .lineWidth(2);
                case 4:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(3); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[3])
                        .lineWidth(2);
                case 3:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(2); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[2])
                        .lineWidth(2);
                case 2:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(1); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[1])
                        .lineWidth(2);
                case 1:
                    panel.add(pv.Line)
                        .data(function(){ return datasel(0); })
                        .left(function(d){ return fx(d.x); })
                        .bottom(function(d){ return fy(d.y); })
                        .strokeStyle(plotcol[0])
                        .lineWidth(2);
            }
            
            /* Context panel (zoomed out). */
            var context = vis.add(pv.Panel)
                .bottom(0)
                .height(h2);
            
            /* X-axis ticks. */
            context.add(pv.Rule)
                .data(x.ticks(5))
                .left(x)
                .lineWidth(function(d){
                    var tmp = new Date(d);
                    if (tmp.getDay() == 6 || tmp.getDay() == 1){
                        if (tmp.getHours() == 0){ return 3; }
                        else return 1;
                    }
                    else return 1;
                })
                .strokeStyle("#aaa")
            .anchor("bottom").add(pv.Label)
                .text(function(x){ return overallDateFormat.format(x); });
            
            /* Y-axis ticks. */
            context.add(pv.Rule)
                .bottom(0);
            
            var totdata = [];
            
            //console.log('DATA LENGTH= '+data[0].length);
            //while (totdata[0].length > 800){
            if (data[0].length < 600) totdata = data;
            else {
                var mydiv = data[0].length / 600;
                var rounddiv = Math.round(mydiv*1)/1;
                        
                for(var p=0; p<data.length; p++){
                    for(var q=0; q<data[p].length;q++){
                        if (q == 0) totdata[p]=[];
                        if (q%rounddiv == 0) totdata[p].push(data[p][q]);
                    }
                }
            }
            
            //if (totdata[0].length > 600){
            //    for(var p=0; p<totdata.length; p++){
            //        for(var q=1; q<totdata[p].length;q++){
            //            if (q%2 == 0) totdata[p].splice(q,1);
            //        }
            //    }
            //}
            
            //console.log(totdata);
            
            
            
            for(var j=0; j<data.length; j++){
                context.add(pv.Line)
                    .data(totdata[j])
                    .left(function(d) x(d.x))
                    .bottom(function(d) y(d.y))
                    .strokeStyle(plotcol[j])
                    .lineWidth(2);
            }
            
            
            /* The selectable, draggable focus region. */
            context.add(pv.Panel)
                .data([i])
                .cursor("crosshair")
                .events("all")
                .event("mousedown", pv.Behavior.select())
                .event("select", focus)
            .add(pv.Bar)
                .left(function(d){ return d.x; })
                .width(function(d) d.dx)
                .fillStyle("rgba(100, 128, 255, .3)")
                .cursor("move")
                .event("mousedown", pv.Behavior.drag())
                .event("drag", focus);
            
            context.add(pv.Dot)
                .left(-15)
                .bottom(25)
                .shape("triangle")
                .angle(Math.PI*0.5)
                .size(110)
                .strokeStyle("darkgrey")
                .lineWidth(2)
                .cursor("pointer")
                .events("all")
                .event("mousedown", addMonth);
            //date1 = new Date();
            vis.render();
            //date2 = new Date();
            //console.log(date2.getMilliseconds()-date1.getMilliseconds());
            //drawgrid();
            
            
        }
        
        function addMonth(){
            //console.log('click');
            plotController.addMonth();
            plotController.calculateData();
            //console.log(plotController.getPlots());
        }
        
        var grid;
        
        var columns = [
            {id:"PlotColour", name:"Colour", field:"colour", width:47, formatter:GraphicalColourCellFormatter},
            {id:"Room", name:"Room", field:"room", width:45},
            {id:"Description", name:"Description", field:"description", width:170},
            {id:"StartMonthyear", name:"Start", field:"startmonthyear", width:100},
            {id:"EndMonthyear", name:"End", field:"endmonthyear", width:100},
            {id:"kWSelected", name:"Avg kW Selected", field:"avgselected", width:115},
            {id:"kWTotal", name:"Avg kW Total", field:"avgtotal", width:95},
            {id:"TotalEnergy", name:"Total Energy (kWh)", field:"totalenergy", width:126},
            //{id:"Data", name:"Raw Data", field:"rawdata", width50},
        ];
        
        var options = {
            //enableCellNavigation: true,
            enableColumnReorder: false,
            //asyncEditorLoading: true,
            editable: true
        };
        
        function SelectCellEditor(args) {
            var $select;
            var defaultValue;
            var scope = this;
            
            this.init = function() {
                
                if(args.column.options){
                    opt_values = args.column.options.split(',');
                }else{
                    opt_values ="yes,no".split(',');
                }
                option_str = ""
                for( i in opt_values ){
                    v = opt_values[i];
                    option_str += "<OPTION value='"+v+"'>"+v+"</OPTION>";
                }
                $select = $("<SELECT class='editor-select'>"+ option_str +"</SELECT>");
                $select.appendTo(args.container);
                $select.focus();
            };
            
            this.destroy = function() {
                $select.remove();
            };
            
            this.focus = function() {
                $select.focus();
            };
            
            this.loadValue = function(item) {
                defaultValue = item[args.column.field];
                $select.val(defaultValue);
                //console.log(defaultValue);
            };
            
            this.serializeValue = function() {
                if(args.column.options){
                    return $select.val();
                }else{
                    return ($select.val() == "yes");
                }
            };
            
            this.applyValue = function(item,state) {
                item[args.column.field] = state;
                //console.log(item+"=>"+state);
            };
            
            this.isValueChanged = function() {
                return ($select.val() != defaultValue);
            };
            
            this.validate = function() {
                return {
                    valid: true,
                    msg: null
                };
            };
            
            this.init();
        }
        
        function drawgrid() {
            dataView = new Slick.Data.DataView();
            
            grid = new Slick.Grid("#myGrid", dataView, columns, options);
            
            dataView.beginUpdate();
            dataView.setItems(plotController.getPlots());
            dataView.endUpdate();
            
            grid.render();
            
            $("#myGrid").show();
        }
        
    </script>
    
    
    
    <link rel="stylesheet" type="text/css" href="css/index.css" media="screen" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/jquery-ui-1.8.5.custom.css" media="screen" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/slick.grid.css" media="screen" charset="utf-8"/>
    <link rel="stylesheet" type="text/css" href="css/grid.css" media="screen" charset="utf-8"/>
</head>
<body>
    <div id="content">
    <div id="top">
    <!--[if IE]>
        <div id="topbar">
            <p class="alert">This tool does not support Internet Explorer. However you can use the tool if you install Google Chrome Frame within Internet Explorer. For more information: <a href="http://www.google.com/chromeframe">http://www.google.com/chromeframe</a>.</p>
            <p class="alert">Alternatively you may use another broswer such as <a href="http://www.google.com/chrome/">Chrome</a>, <a href="http://www.mozilla.com/">Firefox</a> or <a href="http://www.apple.com/safari/">Safari</a>.</p>
        </div>
    <![endif]-->
    <noscript>
        <div id="topbar">
            <p class="alert">Your browser either does not support Javascript or it is not enabled. Please enable JavaScript for full functionality.</p>
        </div>
    </noscript>
    <!--[if !IE]>
    <div id="firstvisit">
        <p class="alert">This tool is still under development. If things stop working a page reload is often the best remedy!</p>
    </div>
    <![endif]-->
    <div style="text-align:center;"><h2>William Gates Building Energy Usage V1.9.5 Alpha</h2></div>
    <div style="text-align:center;"><p>Graphic visualisation of the energy use currently and historically used by the Computer Laboratory.</p></div>
    <div style="float:right; width:400px; text-align:right;padding-right:20;">
    </div>
    <div style="float:left; width:350px; text-align:left;padding-left:20;">
        <label for="treegeo">Explore tree by: Geography</label>
        <input name="treetype" id="treegeo" type="radio" onchange="buildTree('treegeo')">
        <label for="treeuse"> Function</label>
        <input checked name="treetype" id="treeuse" type="radio" onchange="buildTree('treeuse')">
    </div>
    </div>
    <div id="diacontainer">
    <div id="treecontainer">
    <div id="treediv">
    
    </div>
    </div>
    <div id="charttitle">
        <p id="charttitletext"></p>
    </div>
    <div id="chartcontainer">
        <div id="chartdiv">
        </div>
    </div>
    <div id="chartinfo">
        <p class="chartinformation" id="averagekwh"></p>
        <p class="chartinformation" id="overallavgkwh"></p>
        <p class="chartinformation" id="overalltotkwh"></p>
    <div id="myGrid">
    </div>
    </div>
    </div>
</body>
</html>